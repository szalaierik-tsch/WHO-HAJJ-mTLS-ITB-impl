<testcase id="test-mTLS-connection" xmlns="http://www.gitb.com/tdl/v1/" xmlns:gitb="http://www.gitb.com/core/v1/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <metadata>
        <gitb:name>Test out mTLS connection between Participant B and secure Trustlist</gitb:name>
        <gitb:version>1.0</gitb:version>
        <gitb:description>As Participant B I want to download the key of Participant A.</gitb:description>
        <gitb:documentation import="docs/mTLS.html" />
    </metadata>
    <actors>
        <gitb:actor id="theGDHCNParticipant" role="SUT" name="Participant B"/>
    </actors>
    <variables>
        <var type="string" name="environmentSelector">
            <value>DEV</value>
        </var>
    </variables>
    <steps stopOnError="true">
        <group title="only logging" hidden="true">
            <log>"$DOMAIN{helperServiceAddress}::" || $DOMAIN{helperServiceAddress}</log>
            <log>"$SYSTEM{trustAccessPrivateKey}::" || $SYSTEM{trustAccessPrivateKey}</log>
            <log>"$SYSTEM{privateKeyType}::" || $SYSTEM{privateKeyType}</log>
            <log>"$SYSTEM{certFile}::" || $SYSTEM{certFile}</log>
            <log>"$SYSTEM{certPassword}::" || $SYSTEM{certFile}</log>
            <log>"$DOMAIN{secureTrustListDev}::" || $DOMAIN{secureTrustListDev}</log>
        </group>
        <group title="Participant connecting" desc="Testing out TLS Handshake from helper service" collapsed="true">
            
            <process id="sendHTTP" handler="http://host.docker.internal:8181/hajj/services/process?wsdl">
                <operation>connectToTrustlist</operation>
                <input name="privateKey">$SYSTEM{trustAccessPrivateKey}</input>
                <input name="privateKeytype">$SYSTEM{privateKeyType}</input>
                <input name="publicKey">$SYSTEM{certFile}</input>
                <input name="serverAddress">$DOMAIN{secureTrustListDev}</input>
            </process>

            <log>"Response status was:" || $sendHTTP{status}</log>
            <verify id="checkStatusCode" desc="Verify status code is OK" handler="StringValidator">
                <input name="actualstring">$sendHTTP{status}</input>
                <input name="expectedstring">"200"</input>
            </verify>
        </group>
    </steps>
    <output>
        <success>
            <default>"Test case completed successfully."</default>
        </success>
        <failure>
            <case>
                <cond>$STEP_STATUS{sendHTTP} = 'ERROR'</cond>
                <message>"The GET request failed."</message>
            </case>
            <default>"Test case failed. Please check the failed step's report for more information and the test log."</default>
        </failure>
    </output>    
</testcase>