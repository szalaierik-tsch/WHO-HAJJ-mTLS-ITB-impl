<testcase id="test-mTLS-connection" xmlns="http://www.gitb.com/tdl/v1/" xmlns:gitb="http://www.gitb.com/core/v1/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <metadata>
        <gitb:name>Test out mTLS connection between Participant A and Participant B</gitb:name>
        <gitb:version>1.0</gitb:version>
        <gitb:description>As Participant A I want to download the key of Participant B, whitelist it and connect to his services with my own key.</gitb:description>
        <gitb:documentation import="docs/mTLS.html" />
    </metadata>
    <actors>
        <gitb:actor id="foreignParticipant"/>
        <gitb:actor id="sharedService" role="SUT"/>
        <gitb:actor id="gateway"/>
    </actors>
    <variables>
        <var type="string" name="serverRoot">
            <value>$SYSTEM{targetTrustList}</value>
        </var>
        <var type="string" name="privateKeyIn">
            <value>MIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQg+UN8Hw6cNEPCFc3uRXQkBNii+s4hyVacRjFlevN9wXihRANCAATkMJ2ZoBlY+hY1lzaoJx8XsL9DffAU qXyJmng57jumBopVtyGPEVcCjfTQ36MNsXvPg6xB6K9uFxoE9EQqXMdl</value>
        </var>
        <var type="string" name="privateKeyTypeIn">
            <value>EC</value>
        </var>
        <var type="string" name="publicKeyIn">
            <value>-----BEGIN CERTIFICATE-----
                MIICMDCCAdagAwIBAgIUDD737RIT3EGC1fl5J/tlCgvwGlMwCgYIKoZIzj0EAwIw
                dDELMAkGA1UEBhMCWEExFDASBgNVBAgMC1hYQSBDb3VudHJ5MRgwFgYDVQQHDA9Y
                QSBDYXBpdG9sIENpdHkxDDAKBgNVBAoMA1dITzEMMAoGA1UECwwDUiZEMRkwFwYD
                VQQDDBBOYXRpb25YQV9UTlBfVExTMB4XDTI0MDgwMjA3MTY0MVoXDTI1MDgwMjA3
                MTY0MVowdDELMAkGA1UEBhMCWEExFDASBgNVBAgMC1hYQSBDb3VudHJ5MRgwFgYD
                VQQHDA9YQSBDYXBpdG9sIENpdHkxDDAKBgNVBAoMA1dITzEMMAoGA1UECwwDUiZE
                MRkwFwYDVQQDDBBOYXRpb25YQV9UTlBfVExTMFkwEwYHKoZIzj0CAQYIKoZIzj0D
                AQcDQgAE5DCdmaAZWPoWNZc2qCcfF7C/Q33wFKl8iZp4Oe47pgaKVbchjxFXAo30
                0N+jDbF7z4OsQeivbhcaBPREKlzHZaNGMEQwDgYDVR0PAQH/BAQDAgKEMBMGA1Ud
                JQQMMAoGCCsGAQUFBwMCMB0GA1UdDgQWBBTj67Di0BfiuIBRC2EDpf8ZCNSafTAK
                BggqhkjOPQQDAgNIADBFAiEArXzqA55Tp4b7J0LfI5n9moWZDuCJg83SgIsH9klM
                b9ACIDRL89YX3G+DX3dnOKDsRQO4xUbyedOuFr4bJR4sfSVo
                -----END CERTIFICATE-----
            </value>
        </var>
    </variables>
    <steps stopOnError="true">
        <group title="Participant connecting shared service" desc="Testing out TLS Handshake from helper service" collapsed="true">
            <log>"Using: " || $DOMAIN{helperServiceAddress} || " to access: " || $SYSTEM{targetTrustList}</log>
            <log>$DOMAIN{trustlistAddressDEV}</log>
            <log>$SYSTEM{certPassword}</log>
            <process id="sendHTTP" handler="$DOMAIN{helperServiceAddress}">
                <operation>connectToTrustlist</operation>
                <input name="privateKey">$privateKeyIn</input>
                <input name="privateKeytype">$privateKeyTypeIn</input>
                <input name="publicKey">$publicKeyIn</input>
                <input name="serverAddress">$serverRoot</input>
            </process>
<!--            <process id="sendHTTP" desc="Setup configuration" handler="$DOMAIN{processingServiceAddress}" operation="init">-->
<!--                <input name="endpoint">$DOMAIN{testService}</input>-->
<!--            </process>-->
<!--            <send id="sendHTTP" desc="Send a HTTPS request " from="client" to="gateway" handler="$DOMAIN{testService}">-->
<!--&lt;!&ndash;                <input name="uri">$serverRoot || $listCallPath</input>&ndash;&gt;-->
<!--&lt;!&ndash;                <input name="method">"GET"</input>&ndash;&gt;-->
<!--                <input name="messageToSend">"hello"</input>-->
<!--            </send>-->
<!--            <send id="step1" desc="Send message" from="client" to="gateway" handler="$DOMAIN{testService}">-->
<!--                <input name="messageToSend">"hello"</input>-->
<!--            </send>-->
            <log>"Response status was:" || $sendHTTP{status}</log>
<!--            <log>"Response status was:" || $sendHTTP{response}{status}</log>-->
            <verify id="checkStatusCode" desc="Verify status code is OK" handler="StringValidator">
                <input name="actualstring">$sendHTTP{status}</input>
                <input name="expectedstring">"200"</input>
            </verify>
        </group>
    </steps>
    <output>
        <success>
            <default>"Test case completed successfully."</default>
        </success>
        <failure>
            <case>
                <cond>$STEP_STATUS{sendHTTP} = 'ERROR'</cond>
                <message>"The GET request failed."</message>
            </case>
            <default>"Test case failed. Please check the failed step's report for more information and the test log."</default>
        </failure>
    </output>    
</testcase>